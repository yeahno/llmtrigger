name: LLM Trigger

on:
  # 定时触发：每天 6:00 (UTC) 运行一次
  # Cron 格式: 分 时 日 月 周
  # 示例: '0 6 * * *' 表示每天 6:00 (UTC)
  # 注意: GitHub Actions 使用 UTC 时间，国内(北京时区)为 UTC+8
  schedule:
    - cron: '0 6 * * *'
  
  # 允许在 Actions 页面手动触发
  workflow_dispatch:

jobs:
  run-llm-script:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
      
      - name: Debug env presence (masked)
        run: |
          for VAR in API_TYPE API_URL MODEL_NAME PROMPT; do
            if [ -z "${!VAR}" ]; then
              echo "$VAR=EMPTY"
            else
              echo "$VAR=SET"
            fi
          done

      - name: Run LLM Script
        env:
          # 从 GitHub Secrets 获取敏感信息
          API_KEY: ${{ secrets.API_KEY }}
          API_URL: ${{ secrets.API_URL }}
          API_TYPE: ${{ secrets.API_TYPE }}
          MODEL_NAME: ${{ secrets.MODEL_NAME }}
          PROMPT: ${{ secrets.PROMPT }}
        run: python main.py
